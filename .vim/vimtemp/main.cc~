#include <stdlib.h>
#include <fstream>
#include <iostream>
#include <vector>
#include <string>

#include "./thread.h"

#include "./fileserver.h"
#include "./requester.h"

int main(int argc, char *argv[]) {
  auto max_requests = new int();
  *max_requests = atoi(argv[1]);
  if ((argc - 1) < *max_requests) {
    *max_requests = argc - 1;
  }

	auto number_of_files = new int();
  *number_of_files = argc - 2;

  auto fileserver_arguments = new FileserverArguments();
  fileserver_arguments->number_of_files = number_of_files;
  fileserver_arguments->filenames = &argv[2];
  fileserver_arguments->max_requests = max_requests;
  cpu::boot(9, (thread_startfunc_t)fileserver,
            reinterpret_cast<void *>(fileserver_arguments), false, false, 0);
}
